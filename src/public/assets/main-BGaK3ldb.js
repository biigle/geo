import{I as l,E as t,R as d,L as n,S as o,a as g,h as m}from"./imageMap-C2PaZdcc.js";import"vue";const h={data(){return{images:[]}},components:{imageMap:l},created(){let e=biigle.$require("geo.image");this.images=[e]}},c={data(){return{number:0,loading:!1}},created(){this.number=biigle.$require("geo.images").length,t.on("loading.start",()=>{this.loading=!0}),t.on("loading.stop",()=>{this.loading=!1}),t.on("imageMap.update",e=>this.number=e)}},u=d("api/v1/projects{/pid}/images/filter/annotation-label{/lid}"),r={components:{imageMap:l,sidebar:g,sidebarTab:o,labelTrees:n},data:function(){return{selectedLabels:[],filteredImageCache:{},allImages:[],labelTrees:[]}},computed:{filteredImages(){let e=[];if(this.selectedLabels.length>0){let i=this.filteredImageCache[this.selectedLabels[0]];Array.prototype.push.apply(e,i);for(let s=this.selectedLabels.length-1;s>=0;s--){i=this.filteredImageCache[this.selectedLabels[s]];for(let a=i.length-1;a>=0;a--)e.indexOf(i[a])===-1&&e.push(i[a])}}return e},images(){return this.selectedLabels.length>0?this.allImages.filter(e=>this.filteredImages.indexOf(e.id)!==-1):this.allImages},imageCount(){return this.images.length}},methods:{addSelectedLabel(e){this.selectedLabels.indexOf(e.id)===-1&&this.selectedLabels.push(e.id)},handleSelectedLabel(e){this.filteredImageCache.hasOwnProperty(e.id)?this.addSelectedLabel(e):(t.emit("loading.start"),this.getImageFilterApi(e.id).then(i=>{this.filteredImageCache[e.id]=i.data,this.addSelectedLabel(e)},i=>{this.handleDeselectedLabel(e),m(i)}).finally(function(){t.emit("loading.stop")}))},handleDeselectedLabel(e){let i=this.selectedLabels.indexOf(e.id);i!==-1&&this.selectedLabels.splice(i,1)},handleClearedLabels(){this.selectedLabels.splice(0)},handleSidebarToggle(){this.$nextTick(function(){t.emit("sidebar.toggle")})}},watch:{imageCount(e){t.emit("imageMap.update",e)}},created(){this.allImages=biigle.$require("geo.images"),this.labelTrees=biigle.$require("geo.labelTrees")}},p={extends:r,data(){return{projectId:null}},methods:{getImageFilterApi(e){return u.get({pid:this.projectId,lid:e},{})}},created(){this.projectId=biigle.$require("geo.project.id")}},b=d("api/v1/volumes{/vid}/files/filter/annotation-label{/lid}"),f={extends:r,data(){return{volumeId:null}},methods:{getImageFilterApi(e){return b.get({vid:this.volumeId,lid:e},{})}},created(){this.volumeId=biigle.$require("geo.volume.id")}};biigle.$mount("volume-geo-map",f);biigle.$mount("project-geo-map",p);biigle.$mount("geo-image-location-panel",h);biigle.$mount("geo-navbar",c);
