biigle.$declare("geo.events",new Vue),biigle.$viewModel("geo-image-location-panel",function(e){var t=biigle.$require("geo.image");new Vue({el:e,data:{images:[t]},components:{imageMap:biigle.$require("geo.components.imageMap")}})}),biigle.$viewModel("geo-map",function(e){new Vue({el:e,data:{images:biigle.$require("geo.images"),key:"biigle.geo.imageSequence."+biigle.$require("geo.transect.id")},computed:{selectedImages:function(){return JSON.parse(localStorage.getItem(this.key))||[]}},components:{imageMap:biigle.$require("geo.components.imageMap")},methods:{handleSelectedImages:function(e){e.length>0?localStorage.setItem(this.key,JSON.stringify(e)):localStorage.removeItem(this.key)}}})}),biigle.$viewModel("geo-sidebar",function(e){var t=biigle.$require("geo.events");new Vue({el:e,data:{labelTrees:biigle.$require("geo.labelTrees")},components:{sidebar:biigle.$require("geo.components.sidebar"),sidebarTab:biigle.$require("geo.components.sidebarTab"),labelTrees:biigle.$require("geo.components.labelTrees")},methods:{handleSidebarToggle:function(){setTimeout(function(){t.$emit("sidebar.toggle")})}}})}),biigle.$component("geo.components.imageMap",{template:'<div class="image-map"></div>',props:{images:{type:Array,required:!0},preselected:{type:Array,default:function(){return[]}},interactive:{type:Boolean,default:!0},zoom:{type:Number},selectable:{type:Boolean,default:!1}},methods:{parseSelectedFeatures:function(e){return e.getArray().map(function(e){return e.get("id")})}},mounted:function(){for(var e=biigle.$require("geo.ol.style"),t=biigle.$require("geo.events"),l=[],i=this,a=this.images.length-1;a>=0;a--)l.push(new ol.Feature({id:this.images[a].id,preselected:this.preselected.indexOf(this.images[a].id)!==-1,geometry:new ol.geom.Point(ol.proj.fromLonLat([this.images[a].lng,this.images[a].lat]))}));var o=new ol.source.Vector({features:l}),n=o.getExtent(),s=new ol.layer.Tile({source:new ol.source.OSM}),r=new ol.layer.Vector({source:o,style:e.default,updateWhileAnimating:!0,updateWhileInteracting:!0}),c=new ol.Map({target:this.$el,layers:[s,r],view:new ol.View,interactions:ol.interaction.defaults({altShiftDragRotate:!1,doubleClickZoom:this.interactive,keyboard:this.interactive,mouseWheelZoom:this.interactive,shiftDragZoom:!1,dragPan:this.interactive,pinchRotate:!1,pinchZoom:this.interactive}),controls:ol.control.defaults({zoom:this.interactive})});if(c.getView().fit(n,c.getSize()),this.zoom&&c.getView().setZoom(this.zoom),this.interactive&&(c.addControl(new ol.control.ScaleLine),c.addControl(new ol.control.ZoomToExtent({extent:n,label:"î‚—"})),c.addControl(new ol.control.OverviewMap({collapsed:!1,collapsible:!1,layers:[s],view:new ol.View({zoom:1,maxZoom:1})}))),this.selectable){var b=new ol.interaction.Select({style:e.selected,features:l.filter(function(e){return e.get("preselected")})}),p=b.getFeatures();c.addInteraction(b),b.on("select",function(e){i.$emit("select",i.parseSelectedFeatures(p))});var u=new ol.interaction.DragBox({condition:ol.events.condition.platformModifierKeyOnly});c.addInteraction(u),u.on("boxend",function(){p.clear(),o.forEachFeatureIntersectingExtent(u.getGeometry().getExtent(),function(e){p.push(e)}),i.$emit("select",i.parseSelectedFeatures(p))})}t.$on("sidebar.toggle",function(){c.updateSize()})}}),biigle.$component("geo.components.labelTree",{template:'<div class="label-tree"><h4 class="label-tree__title" :if="showTitle" v-text="tree.name"></h4><ul class="label-tree__list"><label-tree-label :label="label" v-for="label in rootLabels" @select="emitSelect"></label-tree-label></ul></div>',components:{labelTreeLabel:biigle.$require("geo.components.labelTreeLabel")},props:{tree:{type:Object,required:!0},showTitle:{type:Boolean,default:!0},standalone:{type:Boolean,default:!1}},computed:{labels:function(){return this.tree.labels},labelMap:function(){for(var e={},t=this.labels.length-1;t>=0;t--)e[this.labels[t].id]=this.labels[t];return e},compiledLabels:function(){for(var e,t={},l=this.labels.length-1;l>=0;l--)e=this.labels[l].parent_id,t.hasOwnProperty(e)?t[e].push(this.labels[l]):t[e]=[this.labels[l]];return t},rootLabels:function(){return this.compiledLabels[null]}},methods:{hasLabel:function(e){return this.labelMap.hasOwnProperty(e)},getLabel:function(e){return this.labelMap[e]},getParents:function(e){for(var t=[];null!==e.parent_id;)e=this.getLabel(e.parent_id),t.unshift(e.id);return t},emitSelect:function(e){this.$emit("select",e)},selectLabel:function(e){var t;for(t=this.labels.length-1;t>=0;t--)this.labels[t].selected=this.labels[t].id===e.id;if(this.hasLabel(e.id)){var l=this.getParents(e);for(t=l.length-1;t>=0;t--)this.getLabel(l[t]).open=!0}}},created:function(){var e=this.compiledLabels;for(i=this.labels.length-1;i>=0;i--)e.hasOwnProperty(this.labels[i].id)&&Vue.set(this.labels[i],"children",e[this.labels[i].id]),Vue.set(this.labels[i],"open",!1),Vue.set(this.labels[i],"selected",!1);this.standalone?this.$on("select",this.selectLabel):this.$parent.$on("select",this.selectLabel)}}),biigle.$component("geo.components.labelTreeLabel",{name:"label-tree-label",template:'<li class="label-tree-label cf" :class="classObject"><div class="label-tree-label__name" @click.stop="select"><span class="label-tree-label__color" :style="colorStyle" @click.stop="toggleOpen"></span><span v-text="label.name"></span><span v-if="showFavourite" class="label-tree-label__favourite" @click.stop="toggleFavourite"><span class="glyphicon" :class="favouriteClass" aria-hidden="true" title=""></span></span></div><ul v-if="label.open" class="label-tree__list"><label-tree-label :label="label" v-for="label in label.children" @select="emitSelect"></label-tree-label></ul></li>',data:function(){return{favourite:!1}},props:{label:{type:Object,required:!0},showFavourite:{type:Boolean,required:!1}},computed:{classObject:function(){return{"label-tree-label--selected":this.label.selected,"label-tree-label--expandable":this.label.children}},colorStyle:function(){return{"background-color":"#"+this.label.color}},favouriteClass:function(){return{"glyphicon-star-empty":!this.favourite,"glyphicon-star":this.favourite}}},methods:{select:function(){this.label.selected?this.label.open=!this.label.open:(this.$emit("select",this.label),this.label.open=!0)},toggleOpen:function(){this.label.open=!this.label.open},toggleFavourite:function(){this.favourite=!this.favourite},emitSelect:function(e){this.$emit("select",e)}}}),biigle.$component("geo.components.labelTrees",{template:'<div class="label-trees"><label-typeahead v-if="typeahead" :labels="labels" @select="handleSelect"></label-typeahead><label-tree :tree="tree" v-for="tree in trees" @select="handleSelect"></label-tree></div>',components:{labelTypeahead:biigle.$require("geo.components.labelTypeahead"),labelTree:biigle.$require("geo.components.labelTree")},props:{trees:{type:Array,required:!0},typeahead:{type:Boolean,default:!0}},computed:{labels:function(){for(var e=[],t=this.trees.length-1;t>=0;t--)Array.prototype.push.apply(e,this.trees[t].labels);return e}},methods:{handleSelect:function(e){this.$emit("select",e)}}}),biigle.$component("geo.components.labelTypeahead",{template:'<typeahead class="label-typeahead" :data="labels" placeholder="Label name" :on-hit="selectLabel" :template="template" match-property="name"></typeahead>',data:function(){return{template:"{{item.name}}"}},components:{typeahead:VueStrap.typeahead},props:{labels:{type:Array,required:!0}},methods:{selectLabel:function(e,t){this.$emit("select",e),t.reset()}}}),biigle.$component("geo.components.sidebar",{template:'<aside class="sidebar" :class="classObject"><div class="sidebar__buttons"><sidebar-button v-for="tab in tabs" :tab="tab"></sidebar-button></div><div class="sidebar__tabs"><slot name="tabs"></slot></div></aside>',components:{sidebarButton:biigle.$require("geo.components.sidebarButton")},data:function(){return{open:!1}},props:{openTab:{type:String}},computed:{classObject:function(){return{"sidebar--open":this.open}},tabs:function(){for(var e=[],t=this.$slots.tabs.length-1;t>=0;t--)e.unshift(this.$slots.tabs[t].componentOptions.propsData);return e}},created:function(){this.$on("open",function(){this.open=!0,this.$emit("toggle")}),this.$on("close",function(){this.open=!1,this.$emit("toggle")})},mounted:function(){this.openTab&&this.$emit("open",this.openTab)}}),biigle.$component("geo.components.sidebarButton",{template:'<button class="sidebar__button btn btn-default btn-lg" :class="classObject" @click="toggle" :title="tab.title"><span v-if="open" class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span><span v-else class="glyphicon" :class="iconClass" aria-hidden="true"></span></button>',data:function(){return{open:!1}},props:{tab:{type:Object,required:!0}},computed:{iconClass:function(){return"glyphicon-"+this.tab.icon},classObject:function(){return{active:this.open}}},methods:{toggle:function(){this.open?this.$parent.$emit("close"):this.$parent.$emit("open",this.tab.name)}},mounted:function(){var e=this;this.$parent.$on("open",function(t){e.open=t===e.tab.name}),this.$parent.$on("close",function(){e.open=!1})}}),biigle.$component("geo.components.sidebarTab",{template:'<div class="sidebar__tab" :class="classObject"><slot></slot></div>',data:function(){return{open:!1}},props:{name:{type:String,required:!0},icon:{type:String,required:!0},title:{type:String}},computed:{classObject:function(){return{"sidebar__tab--open":this.open}}},created:function(){var e=this;this.$parent.$on("open",function(t){e.open=t===e.name}),this.$parent.$on("close",function(){e.open=!1})}}),biigle.$declare("geo.ol.style",function(){var e={colors:{blue:"#0099ff",white:"#ffffff",orange:"#ff5e00"},radius:{default:6},strokeWidth:{default:2}};return ol&&(e.default=new ol.style.Style({image:new ol.style.Circle({radius:e.radius.default,fill:new ol.style.Fill({color:e.colors.blue}),stroke:new ol.style.Stroke({color:e.colors.white,width:e.strokeWidth.default})})}),e.selected=new ol.style.Style({image:new ol.style.Circle({radius:e.radius.default,fill:new ol.style.Fill({color:e.colors.orange}),stroke:new ol.style.Stroke({color:e.colors.white,width:e.strokeWidth.default})}),zIndex:1/0})),e});