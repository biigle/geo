biigle.geo={},biigle.$viewModel("geo-image-location-panel",function(e){new Vue({el:e,data:{images:[biigle.geo.image]},components:{imageMap:biigle.geo.components.imageMap}})}),biigle.$viewModel("geo-map",function(e){new Vue({el:e,data:{images:biigle.geo.images,key:"biigle.geo.imageSequence."+biigle.geo.transect.id},computed:{selectedImages:function(){return JSON.parse(localStorage.getItem(this.key))||[]}},components:{imageMap:biigle.geo.components.imageMap},methods:{handleSelectedImages:function(e){e.length>0?localStorage.setItem(this.key,JSON.stringify(e)):localStorage.removeItem(this.key)}}})}),biigle.geo.components={},biigle.geo.components.imageMap={template:'<div class="image-map"></div>',props:{images:{type:Array,required:!0},preselected:{type:Array,default:function(){return[]}},interactive:{type:Boolean,default:!0},zoom:{type:Number},selectable:{type:Boolean,default:!1}},methods:{extractFeatureId:function(e){},parseSelectedFeatures:function(e){return e.getArray().map(function(e){return e.get("id")})}},mounted:function(){for(var e=[],t=this,o=this.images.length-1;o>=0;o--)e.push(new ol.Feature({id:this.images[o].id,preselected:this.preselected.indexOf(this.images[o].id)!==-1,geometry:new ol.geom.Point(ol.proj.fromLonLat([this.images[o].lng,this.images[o].lat]))}));var i=new ol.source.Vector({features:e}),l=i.getExtent(),a=new ol.layer.Tile({source:new ol.source.OSM}),n=new ol.layer.Vector({source:i,style:biigle.geo.ol.style.default,updateWhileAnimating:!0,updateWhileInteracting:!0}),r=new ol.Map({target:this.$el,layers:[a,n],view:new ol.View,interactions:ol.interaction.defaults({altShiftDragRotate:!1,doubleClickZoom:this.interactive,keyboard:this.interactive,mouseWheelZoom:this.interactive,shiftDragZoom:this.interactive,dragPan:this.interactive,pinchRotate:!1,pinchZoom:this.interactive,dragZoom:!1}),controls:ol.control.defaults({zoom:this.interactive})});if(r.getView().fit(l,r.getSize()),this.zoom&&r.getView().setZoom(this.zoom),this.interactive&&(r.addControl(new ol.control.ScaleLine),r.addControl(new ol.control.ZoomToExtent({extent:l,label:"î‚—"})),r.addControl(new ol.control.OverviewMap({collapsed:!1,collapsible:!1,layers:[a],view:new ol.View({zoom:1,maxZoom:1})}))),this.selectable){var s=new ol.interaction.Select({style:biigle.geo.ol.style.selected,features:e.filter(function(e){return e.get("preselected")})}),g=s.getFeatures();r.addInteraction(s),s.on("select",function(e){t.$emit("select",t.parseSelectedFeatures(g))});var c=new ol.interaction.DragBox({condition:ol.events.condition.platformModifierKeyOnly});r.addInteraction(c),c.on("boxend",function(){g.clear(),i.forEachFeatureIntersectingExtent(c.getGeometry().getExtent(),function(e){g.push(e)}),t.$emit("select",t.parseSelectedFeatures(g))})}}},biigle.geo.ol={},ol&&(biigle.geo.ol.style={colors:{blue:"#0099ff",white:"#ffffff",orange:"#ff5e00"},radius:{default:6},strokeWidth:{default:2}},biigle.geo.ol.style.default=new ol.style.Style({image:new ol.style.Circle({radius:biigle.geo.ol.style.radius.default,fill:new ol.style.Fill({color:biigle.geo.ol.style.colors.blue}),stroke:new ol.style.Stroke({color:biigle.geo.ol.style.colors.white,width:biigle.geo.ol.style.strokeWidth.default})})}),biigle.geo.ol.style.selected=new ol.style.Style({image:new ol.style.Circle({radius:biigle.geo.ol.style.radius.default,fill:new ol.style.Fill({color:biigle.geo.ol.style.colors.orange}),stroke:new ol.style.Stroke({color:biigle.geo.ol.style.colors.white,width:biigle.geo.ol.style.strokeWidth.default})}),zIndex:1/0}));