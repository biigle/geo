biigle.geo={},biigle.$viewModel("geo-image-location-panel",function(e){new Vue({el:e,data:{images:[biigle.geo.image]},components:{imageMap:biigle.geo.components.imageMap}})}),biigle.$viewModel("geo-map",function(e){new Vue({el:e,data:{images:biigle.geo.images},components:{imageMap:biigle.geo.components.imageMap},methods:{handleSelectedImages:function(e){console.log(e)}}})}),biigle.geo.components={},biigle.geo.components.imageMap={template:'<div class="image-map"></div>',props:{images:{type:Array,required:!0},interactive:{type:Boolean,default:!0},zoom:{type:Number},cluster:{type:Boolean,default:!1},selectable:{type:Boolean,default:!1}},methods:{extractFeatureId:function(e){return e.get("id")},parseSelectedFeatures:function(e){var t=[];return e.forEach(function(e){this.cluster&&e.get("features")?Array.prototype.push.apply(t,e.get("features").map(this.extractFeatureId)):t.push(this.extractFeatureId(e))},this),t}},mounted:function(){for(var e=[],t=this,o=this.images.length-1;o>=0;o--)e.push(new ol.Feature({id:this.images[o].id,geometry:new ol.geom.Point(ol.proj.fromLonLat([this.images[o].lng,this.images[o].lat]))}));var l=new ol.source.Vector({features:e}),i=l.getExtent();this.cluster&&(l=new ol.source.Cluster({source:l,distance:5}));var a=new ol.layer.Tile({source:new ol.source.OSM}),n=new ol.layer.Vector({source:l,style:biigle.geo.ol.style.default,updateWhileAnimating:!0,updateWhileInteracting:!0}),s=new ol.Map({target:this.$el,layers:[a,n],view:new ol.View,interactions:ol.interaction.defaults({altShiftDragRotate:!1,doubleClickZoom:this.interactive,keyboard:this.interactive,mouseWheelZoom:this.interactive,shiftDragZoom:this.interactive,dragPan:this.interactive,pinchRotate:!1,pinchZoom:this.interactive,dragZoom:!1}),controls:ol.control.defaults({zoom:this.interactive})});if(s.addControl(new ol.control.ScaleLine),s.getView().fit(i,s.getSize()),this.zoom&&s.getView().setZoom(this.zoom),this.interactive&&(s.addControl(new ol.control.ZoomToExtent({extent:i,label:"î‚—",tipLabel:"Reset Zoom"})),s.addControl(new ol.control.OverviewMap({collapsed:!1,collapsible:!1,layers:[a],view:new ol.View({zoom:1,maxZoom:1})}))),this.selectable){var r=new ol.interaction.Select({style:biigle.geo.ol.style.selected}),g=r.getFeatures();s.addInteraction(r),r.on("select",function(e){t.$emit("select",t.parseSelectedFeatures(g))});var c=new ol.interaction.DragBox({condition:ol.events.condition.platformModifierKeyOnly});s.addInteraction(c),c.on("boxend",function(){g.clear(),l.forEachFeatureIntersectingExtent(c.getGeometry().getExtent(),function(e){g.push(e)}),t.$emit("select",t.parseSelectedFeatures(g))})}}},biigle.geo.ol={},ol&&(biigle.geo.ol.style={colors:{blue:"#0099ff",white:"#ffffff",orange:"#ff5e00"},radius:{default:6},strokeWidth:{default:2}},biigle.geo.ol.style.default=new ol.style.Style({image:new ol.style.Circle({radius:biigle.geo.ol.style.radius.default,fill:new ol.style.Fill({color:biigle.geo.ol.style.colors.blue}),stroke:new ol.style.Stroke({color:biigle.geo.ol.style.colors.white,width:biigle.geo.ol.style.strokeWidth.default})})}),biigle.geo.ol.style.selected=new ol.style.Style({image:new ol.style.Circle({radius:biigle.geo.ol.style.radius.default,fill:new ol.style.Fill({color:biigle.geo.ol.style.colors.orange}),stroke:new ol.style.Stroke({color:biigle.geo.ol.style.colors.white,width:biigle.geo.ol.style.strokeWidth.default})}),zIndex:1/0}));