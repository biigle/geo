import{I as s,E as i,R as d,h as r,L as o,S as g,a as m}from"./imageMap-fHwHwLjf.js";import"vue";const c={data(){return{images:[]}},components:{imageMap:s},created(){let e=biigle.$require("geo.image");this.images=[e]}},h={data(){return{images:[],loading:!1}},computed:{number(){return this.images.length}},created(){this.images=biigle.$require("geo.images"),i.$on("loading.start",()=>{this.loading=!0}),i.$on("loading.stop",()=>{this.loading=!1}),i.$on("imageMap.update",e=>{this.images=e})}},b=d("api/v1/projects{/pid}/images/filter/annotation-label{/lid}"),n={components:{imageMap:s},data:function(){return{selectedLabels:[],filteredImageCache:{},allImages:[]}},computed:{filteredImages(){let e=[];if(this.selectedLabels.length>0){let t=this.filteredImageCache[this.selectedLabels[0]];Array.prototype.push.apply(e,t);for(let l=this.selectedLabels.length-1;l>=0;l--){t=this.filteredImageCache[this.selectedLabels[l]];for(let a=t.length-1;a>=0;a--)e.indexOf(t[a])===-1&&e.push(t[a])}}return e},images(){return this.selectedLabels.length>0?this.allImages.filter(e=>this.filteredImages.indexOf(e.id)!==-1):this.allImages}},methods:{addSelectedLabel(e){this.selectedLabels.indexOf(e.id)===-1&&this.selectedLabels.push(e.id)},handleSelectedLabel(e){this.filteredImageCache.hasOwnProperty(e.id)?this.addSelectedLabel(e):(i.$emit("loading.start"),this.getImageFilterApi(e.id).then(t=>{this.filteredImageCache[e.id]=t.data,this.addSelectedLabel(e)},t=>{this.handleDeselectedLabel(e),r(t)}).finally(function(){i.$emit("loading.stop")}))},handleDeselectedLabel(e){let t=this.selectedLabels.indexOf(e.id);t!==-1&&this.selectedLabels.splice(t,1)},handleClearedLabels(){this.selectedLabels.splice(0)}},watch:{images(e){i.$emit("imageMap.update",e)}},created(){this.allImages=biigle.$require("geo.images"),i.$on("label.selected",this.handleSelectedLabel),i.$on("label.deselected",this.handleDeselectedLabel),i.$on("label.cleared",this.handleClearedLabels)}},p={mixins:[n],data(){return{projectId:null}},methods:{getImageFilterApi(e){return b.get({pid:this.projectId,lid:e},{})}},created(){this.projectId=biigle.$require("geo.project.id")}},u={data(){return{labelTrees:[]}},components:{sidebar:m,sidebarTab:g,labelTrees:o},methods:{handleSidebarToggle(){this.$nextTick(function(){i.$emit("sidebar.toggle")})},handleSelect(e){i.$emit("label.selected",e)},handleDeselect(e){i.$emit("label.deselected",e)},handleCleared(){i.$emit("label.cleared")}},created(){this.labelTrees=biigle.$require("geo.labelTrees")}},f=d("api/v1/volumes{/vid}/files/filter/annotation-label{/lid}"),$={mixins:[n],data(){return{volumeId:null}},methods:{getImageFilterApi(e){return f.get({vid:this.volumeId,lid:e},{})}},created(){this.volumeId=biigle.$require("geo.volume.id")}};biigle.$mount("volume-geo-map",$);biigle.$mount("project-geo-map",p);biigle.$mount("geo-image-location-panel",c);biigle.$mount("geo-navbar",h);biigle.$mount("geo-sidebar",u);
